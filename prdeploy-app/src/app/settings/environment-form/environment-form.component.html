<div class="environment-settings">
  <form>
    <h4 class="field-group-title">General</h4>
    <div class="field-section">
      <mat-form-field>
        <mat-label>Name</mat-label>
        <input matInput type="text" [(ngModel)]="environment.name" name="name" [disabled]="!hasEnvironments" />
      </mat-form-field>

      <mat-form-field>
        <mat-label>Queue</mat-label>
        <input matInput type="text" [(ngModel)]="environment.queue" name="queue" [disabled]="!hasEnvironments" />
      </mat-form-field>

      <mat-form-field class="form-field-2x">
        <mat-label>URL</mat-label>
        <input matInput type="text" [(ngModel)]="environment.url" name="url" [disabled]="!hasEnvironments" />
      </mat-form-field>

      <div class="field-section">
        <mat-checkbox [(ngModel)]="environment.requireApproval" name="requireApproval">Require approval</mat-checkbox>

        <mat-checkbox [(ngModel)]="environment.requireBranchUpToDate" name="requireBranchUpToDate">
          Require branch up to date
        </mat-checkbox>
      </div>
    </div>

    <div class="add-items">
      <span>Exclude from rollback</span>
      <button
        mat-icon-button
        color="success"
        class="add-item-input-btn exclude-rollback"
        title="Add service to exclude"
        (click)="showAddExcludeRollbackService()"
        [disabled]="!hasEnvironments">
        <mat-icon>add</mat-icon>
      </button>
    </div>
    @for (item of environment.excludeFromRollback; track item) {
      <div class="field exclude-rollback-field">
        <label>{{ item }}</label>
        <div class="field-value field-removable">
          <button
            mat-icon-button
            color="warn"
            class="add-workflow-input-btn exclude-rollback"
            title="Remove service to exclude"
            (click)="removeExcludeRollbackService(item)"
            [disabled]="!hasEnvironments">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </div>
    }

    <h4 class="field-group-title">Automation Test</h4>
    <div class="field-section">
      <mat-checkbox [(ngModel)]="environment.automationTest.enabled" name="automationTestEnabled">Enabled</mat-checkbox>

      <mat-form-field class="form-field-2x">
        <mat-label>GitHub workfow</mat-label>
        <input
          matInput
          type="text"
          [(ngModel)]="environment.automationTest.workflow"
          name="automationTestWorkflow"
          [disabled]="!hasEnvironments" />
      </mat-form-field>
    </div>

    <div class="add-items">
      <div>
        <span>Workflow inputs</span>
        <button
          mat-icon-button
          color="success"
          class="add-item-input-btn exclude-rollback"
          title="Add workflow input"
          (click)="showAddAutomationInput()"
          [disabled]="!hasEnvironments">
          <mat-icon>add</mat-icon>
        </button>
      </div>
      @for (item of environment.automationTest.inputs | keyvalue; track item.key) {
        <div class="field">
          <label>{{ item.key }}</label>
          <div class="field-value field-removable">
            <dx-text-box
              [value]="item.value?.toString()"
              (onValueChanged)="updateAutomationInput($event, item.key)"
              [disabled]="!hasEnvironments"></dx-text-box>
            <button
              mat-icon-button
              color="warn"
              class="add-workflow-input-btn exclude-rollback"
              title="Remove workflow input"
              (click)="removeAutomationInput(item.key)"
              [disabled]="!hasEnvironments">
              <mat-icon>close</mat-icon>
            </button>
          </div>
        </div>
      }
    </div>
  </form>
</div>
